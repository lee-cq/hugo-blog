<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="å¯¹ä¸€ç»„æä¾›ç›¸åŒåŠŸèƒ½çš„Podçš„æŠ½è±¡ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚"><title>Kubernetesçš„æœåŠ¡è®¿é—®-Service</title><link rel=canonical href=https://blog-g.leecq.cn/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Kubernetesçš„æœåŠ¡è®¿é—®-Service"><meta property='og:description' content="å¯¹ä¸€ç»„æä¾›ç›¸åŒåŠŸèƒ½çš„Podçš„æŠ½è±¡ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚"><meta property='og:url' content='https://blog-g.leecq.cn/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/'><meta property='og:site_name' content='LeeCQå°ç©ºé—´'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='K8s'><meta property='article:tag' content='Kubernetes'><meta property='article:tag' content='è¿ç»´'><meta property='article:tag' content='Service'><meta property='article:tag' content='æœåŠ¡è®¿é—®'><meta property='article:published_time' content='2024-08-06T00:00:00+00:00'><meta property='article:modified_time' content='2024-08-06T00:00:00+00:00'><meta name=twitter:title content="Kubernetesçš„æœåŠ¡è®¿é—®-Service"><meta name=twitter:description content="å¯¹ä¸€ç»„æä¾›ç›¸åŒåŠŸèƒ½çš„Podçš„æŠ½è±¡ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_f509edb42ecc0ebd.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>LeeCQå°ç©ºé—´</a></h1><h2 class=site-description>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</h2></div></header><ol class=menu-social><li><a href=https://github.com/Lee-CQ/hugo-blog target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://leecq.cn target=_blank title=Home rel=me><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/tools/><svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 2a1 1 0 00-.707 1.707L7 4.414v3.758a1 1 0 01-.293.707l-4 4C.817 14.769 2.156 18 4.828 18h10.343c2.673.0 4.012-3.231 2.122-5.121l-4-4A1 1 0 0113 8.172V4.414l.707-.707A1 1 0 0013 2H7zm2 6.172V4h2v4.172a3 3 0 00.879 2.12l1.027 1.028a4 4 0 00-2.171.102l-.47.156a4 4 0 01-2.53.0l-.563-.187a1.993 1.993.0 00-.114-.035l1.063-1.063A3 3 0 009 8.172z" clip-rule="evenodd"/></svg>
<span>Tools</span></a></li><li><a href=https://leecq.cn/ target=_blank><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>home</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#åˆ›å»ºservice>åˆ›å»ºService</a></li><li><a href=#ä½¿ç”¨service>ä½¿ç”¨Service</a></li><li><a href=#servicenameè®¿é—®service>ServiceNameè®¿é—®Service</a></li><li><a href=#å®ç°åŸç†>å®ç°åŸç†</a></li><li><a href=#serviceçš„ç±»å‹>Serviceçš„ç±»å‹</a><ol><li><a href=#nodeport>NodePort</a></li><li><a href=#loadbalancer>LoadBalancer</a></li><li><a href=#headless-service>Headless Service</a><ol><li><a href=#åˆ›å»ºheadless-service>åˆ›å»ºHeadless Service</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/>Kubernetesçš„æœåŠ¡è®¿é—®-Service</a></h2><h3 class=article-subtitle>å¯¹ä¸€ç»„æä¾›ç›¸åŒåŠŸèƒ½çš„Podçš„æŠ½è±¡ï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ã€‚</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 06, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 9 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>ç”±äºç›´æ¥è®¿é—®Podå­˜åœ¨ä¸€ä¸‹é—®é¢˜ï¼š</p><ul><li>æ¯ä¸ªPodåœ¨å¯åŠ¨åæ‰ä¼šè¢«åˆ†é…ä¸€ä¸ªå¯ç‹¬ç«‹è®¿é—®çš„IPï¼Œä¸å…¶ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œåœ¨Podå¯åŠ¨å‰å¹¶ä¸çŸ¥é“Podçš„IPåœ°å€ã€‚</li><li>å½“Podè¢«åˆ é™¤æˆ–è€…Podæ‰€åœ¨èŠ‚ç‚¹æ•…éšœæ—¶ï¼ŒKubernetesä¼šæ ¹æ®å‰¯æœ¬æœŸæœ›æ•°é‡æ–°æ‹‰èµ·æ–°podï¼Œæ—§çš„PodIPå¯èƒ½æ— æ³•æ­£å¸¸è®¿é—®ã€‚</li><li>åº”ç”¨å¾€å¾€æœ‰å¤šä¸ªå‰¯æœ¬å®ä¾‹ï¼ˆPodï¼‰ï¼Œå¤šä¸ªå‰¯æœ¬å®ä¾‹å…±åŒå¯¹å¤–æä¾›æœåŠ¡ã€‚ä½¿ç”¨å•ä¸€çš„PodIPè¿›è¡Œè®¿é—®ä¸èƒ½å®ç°Podé—´è´Ÿè½½å‡è¡¡ã€‚</li></ul><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image.png width=1228 height=375 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image_hu_e0db098d87508bb5.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image_hu_95c839f547cf4d18.png 1024w" loading=lazy alt=Podæ›´æ–°/é‡å¯/è¿ç§»ä¼šå¯¼è‡´IPå‘ç”Ÿå˜åŒ– class=gallery-image data-flex-grow=327 data-flex-basis=785px></p><p>æ‰€ä»¥Kuberneteså¼•å…¥Serviceè§£å†³Podçš„è®¿é—®é—®é¢˜</p><p>æ·»åŠ ä¸€ä¸ªServiceï¼Œå³å¯é€šè¿‡Serviceæ¥è®¿é—®Podï¼ŒServiceæœ‰ä¸€ä¸ªå›ºå®šIPçš„åœ°å€ï¼Œå°†è®¿é—®å®ƒçš„æµé‡è½¬å‘ç»™Podï¼Œå…·ä½“è½¬å‘ç»™å“ªäº›Podé€šè¿‡LabelSelectoræ¥é€‰æ‹©ã€‚</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-1.png width=819 height=385 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-1_hu_e1a59bbeac511ecf.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-1_hu_d7fc83cc2de2ce73.png 1024w" loading=lazy alt=é€šè¿‡æ ‡ç­¾é€‰æ‹©ï¼Œå°†æµé‡è´Ÿè½½åˆ°æŒ‡å®šçš„Pod class=gallery-image data-flex-grow=212 data-flex-basis=510px></p><h2 id=åˆ›å»ºservice>åˆ›å»ºService</h2><p>ç¤ºä¾‹ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx      </span><span class=w> </span><span class=c># Serviceçš„åç§°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>         </span><span class=c># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œé€‰æ‹©åŒ…å«app=nginxæ ‡ç­¾çš„Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>  </span><span class=c># Podçš„ç«¯å£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>      </span><span class=c># Serviceå¯¹å¤–æš´éœ²çš„ç«¯å£</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP  </span><span class=w> </span><span class=c># è½¬å‘åè®®ç±»å‹ï¼Œæ”¯æŒTCPå’ŒUDP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP  </span><span class=w> </span><span class=c># Serviceçš„ç±»å‹</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ç¤ºä¾‹åˆ›å»ºä¸€ä¸ªåä¸ºâ€œnginxâ€çš„Serviceï¼Œé€šè¿‡selectoré€‰æ‹©åˆ°æ ‡ç­¾ä¸ºâ€œapp:nginxâ€çš„Podï¼Œç›®æ ‡Podçš„ç«¯å£ä¸º80ï¼ŒServiceå¯¹å¤–æš´éœ²çš„ç«¯å£ä¸º8080ï¼ŒServiceç±»å‹ä¸ºClusterIPï¼Œåˆ›å»ºåkubernetesä¼šè‡ªåŠ¨ä¸ºServiceåˆ†é…ä¸€ä¸ªIPåœ°å€ï¼Œå¦‚å›¾ç¤ºçš„10.247.124.252ã€‚</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-2.png width=541 height=361 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-2_hu_4435ff296ced1470.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-2_hu_5f86dd3144cdef98.png 1024w" loading=lazy alt=å…¶ä»–Podè®¿é—®Service class=gallery-image data-flex-grow=149 data-flex-basis=359px></p><p>å…¶ä»–podå¯é€šè¿‡ClusterIP:Portçš„å½¢å¼è®¿é—®åˆ°åç«¯Podã€‚</p><h2 id=ä½¿ç”¨service>ä½¿ç”¨Service</h2><p>å°†ä¸Šè¿°Serviceçš„å®šä¹‰ä¿å­˜è‡³nginx-svc.yamlæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨kubectlå‘½ä»¤åˆ›å»ºè¯¥Serviceã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl create -f nginx-svc.yaml
</span></span><span class=line><span class=cl>service/nginxcreated
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectl get svc
</span></span><span class=line><span class=cl>NAME        TYPE      CLUSTER-IP      EXTERNAL-IP PORT(S)  AGE
</span></span><span class=line><span class=cl>kubernetes  ClusterIP 10.247.0.1      &lt;none&gt;      443/TCP  7h19m
</span></span><span class=line><span class=cl>nginx       ClusterIP 10.247.124.252  &lt;none&gt;      8080/TCP 5h48m
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°Serviceæœ‰ä¸ªCluster IPï¼Œè¿™ä¸ªIPæ˜¯å›ºå®šä¸å˜çš„ï¼Œé™¤éServiceè¢«åˆ é™¤ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ClusterIPåœ¨é›†ç¾¤å†…éƒ¨è®¿é—®Serviceã€‚</p><h2 id=servicenameè®¿é—®service>ServiceNameè®¿é—®Service</h2><p>é™¤äº†ç”¨ClusterIPçš„å½¢å¼è®¿é—®Serviceï¼Œä¹Ÿå¯ä»¥ç”¨ServiceNameçš„å½¢å¼æ¥è®¿é—®Serviceã€‚</p><p>ç”¨ServiceNameçš„å½¢å¼æ¥è®¿é—®Serviceæ—¶ï¼Œå°±éœ€è¦DNSæ’ä»¶è¿›è¡ŒåŸŸåè§£æï¼Œåœ¨å®‰è£…Kubernetesæ—¶ï¼Œä¼šé»˜è®¤è¦æ±‚å®‰è£…CoreDNSæ’ä»¶ã€‚</p><p>åœ¨kube-systemå‘½åç©ºé—´ä¸‹å¯ä»¥æŸ¥çœ‹åˆ°è¿è¡ŒCoreDNSçš„Podã€‚ <code>kubectl get po --namespace=kube-system</code></p><p><strong>è®¿é—®å½¢å¼ï¼š</strong> <code>&lt;ServiceName>.&lt;namespace>.svc.cluster.local</code>
<img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-3.png width=735 height=157 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-3_hu_1b98ce9d637b01e9.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-3_hu_c5b77a267c93f6d6.png 1024w" loading=lazy alt=è®¿é—®å½¢å¼ class=gallery-image data-flex-grow=468 data-flex-basis=1123px></p><blockquote><p>å®é™…ä¸Šåœ¨åŒä¸€ä¸ªå‘½åç©ºé—´ä¸­å¯ä»¥çœç•¥<code>&lt;namespace>.svc.cluster.local</code>, ç›´æ¥ç”¨ServiceName, å› ä¸ºåœ¨åŒä¸€ä¸ªDNSæœç´¢åŸŸä¸­ã€‚<br>ä¾‹å¦‚ä¹‹å‰åˆ›å»ºçš„åä¸ºnginxçš„Serviceï¼Œç›´æ¥é€šè¿‡â€œnginx:8080â€å°±å¯ä»¥è®¿é—®åˆ°Serviceï¼Œè¿›è€Œè®¿é—®åå°Podã€‚</p></blockquote><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-4.png width=621 height=401 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-4_hu_4bd28b7766ac4114.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-4_hu_2c662cab45ad4ad3.png 1024w" loading=lazy alt=ServiceNameè®¿é—®Service class=gallery-image data-flex-grow=154 data-flex-basis=371px></p><p>Podä»¥ServiceNameçš„å½¢å¼ä¹Ÿå°±æ˜¯â€œServiceName:Portâ€çš„å½¢å¼è®¿é—®æ—¶ï¼ŒCoreDNSå°±ä¼šå°†ServiceNameè§£æä¸ºClusterIPï¼Œä»è€Œè®¿é—®åˆ°åç«¯Podã€‚</p><h2 id=å®ç°åŸç†>å®ç°åŸç†</h2><p>Serviceæ˜¯å¦‚ä½•åšåˆ°ä½¿å®¢æˆ·ç«¯æˆ–å…¶ä»–Podèƒ½å¤Ÿç¨³å®šè®¿é—®åˆ°ä¸€ç»„è¿è¡Œç€ç‰¹å®šæœåŠ¡çš„åç«¯Podå‘¢ï¼Ÿ</p><p>è°ƒç”¨kubectldescribeå‘½ä»¤æŸ¥çœ‹Serviceçš„ä¿¡æ¯ï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹å›æ˜¾ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl describe svc nginx
</span></span><span class=line><span class=cl>Name: nginx
</span></span><span class=line><span class=cl>......
</span></span><span class=line><span class=cl>Endpoints: 172.16.2.132:80,172.16.3.6:80,172.16.3.7:80
</span></span><span class=line><span class=cl>......
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªEndpointsï¼ŒEndpointsåŒæ ·ä¹Ÿæ˜¯Kubernetesçš„ä¸€ç§èµ„æºå¯¹è±¡ã€‚Kubernetesæ­£æ˜¯é€šè¿‡Endpointsç›‘æ§åˆ°Podçš„IPï¼Œä»è€Œè®©Serviceèƒ½å¤Ÿå‘ç°Podã€‚å¦‚æ‰§è¡Œå‘½ä»¤kubectlget endpointsæŸ¥çœ‹Endpointsçš„è¯¦ç»†ä¿¡æ¯ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectlget endpoints
</span></span><span class=line><span class=cl>NAME    ENDPOINTS                                   AGE
</span></span><span class=line><span class=cl>nginx   172.16.2.132:80,172.16.3.6:80,172.16.3.7:80 5h48m
</span></span></code></pre></td></tr></table></div></div><p>é…ç½®äº†selectorçš„Serviceåœ¨åˆ›å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåŒåçš„Endpointsï¼Œé€šè¿‡Label Selectorå°†å¸¦æœ‰ç›¸åº”æ ‡ç­¾çš„Podç­›é€‰å‡ºæ¥ï¼ŒEndpointså°†è¿™äº›Podçš„IPåŠç«¯å£ä¿¡æ¯è®°å½•ä¸‹æ¥ã€‚</p><p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹Podçš„IPï¼Œå¯çœ‹åˆ°è¿è¡Œç€nginxçš„Podçš„IPä¸å‰è¿°Endpointså¯¹è±¡ç»´æŠ¤çš„IPä¸€è‡´ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectl get po -o wide
</span></span><span class=line><span class=cl>NAME                    READY STATUS  RESTARTS AGE IP           NODE
</span></span><span class=line><span class=cl>nginx-869759589d-dnknn  1/1   Running 0      5h40m 172.16.3.7   192.168.0.212
</span></span><span class=line><span class=cl>nginx-869759589d-fcxhh  1/1   Running 0      5h40m 172.16.3.6   192.168.0.212
</span></span><span class=line><span class=cl>nginx-869759589d-r69kh  1/1   Running 0      5h40m 172.16.2.132 192.168.0.94
</span></span></code></pre></td></tr></table></div></div><p>å¦‚æœåˆ é™¤ä¸€ä¸ªPodï¼ŒDeploymentä¼šå°†Podé‡å»ºï¼Œæ–°çš„Pod IPä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ kubectldelete po nginx-869759589d-dnknn
</span></span><span class=line><span class=cl>pod &#34;nginx-869759589d-dnknn&#34; deleted
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ kubectlget po -o wide
</span></span><span class=line><span class=cl>NAME                    READY STATUS RESTARTS AGE   IP            NODE
</span></span><span class=line><span class=cl>nginx-869759589d-fcxhh  1/1   Running 0       5h41m 172.16.3.6    192.168.0.212
</span></span><span class=line><span class=cl>nginx-869759589d-r69kh  1/1   Running 0       5h41m 172.16.2.132  192.168.0.94
</span></span><span class=line><span class=cl>nginx-869759589d-w98wg  1/1   Running 0       7s    172.16.3.10   192.168.0.212
</span></span></code></pre></td></tr></table></div></div><p>å†æ¬¡æŸ¥çœ‹Endpointsï¼Œä¼šå‘ç°Endpointsçš„å†…å®¹ä¹Ÿéšç€Podå‘ç”Ÿäº†å˜åŒ–ã€‚</p><hr><p>å®é™…ä¸Šï¼Œå…·ä½“çš„Serviceæµé‡è·¯ç”±æ˜¯Kube-Proxyç»„ä»¶å’ŒIptablesæ¥å…±åŒå®ç°çš„ã€‚</p><p>åœ¨Serviceåˆ›å»ºæ—¶Kubernetesä¼šåˆ†é…IPç»™Serviceï¼ŒåŒæ—¶é€šè¿‡APIServeré€šçŸ¥æ‰€æœ‰kube-proxyæœ‰æ–°çš„Serviceåˆ›å»ºäº†ï¼Œkube-proxyæ”¶åˆ°é€šçŸ¥åé€šè¿‡iptablesè®°å½•Serviceå’ŒPodçš„IP/ç«¯å£å¯¹çš„å…³ç³»ï¼Œä»è€Œè®©Serviceåœ¨èŠ‚ç‚¹ä¸Šå¯ä»¥è¢«æŸ¥è¯¢åˆ°ã€‚</p><p><strong>iptables</strong>æ˜¯è¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´çš„åº”ç”¨è½¯ä»¶ï¼Œé€šè¿‡æ§åˆ¶Linuxå†…æ ¸netfilteræ¨¡å—ï¼Œæ¥ç®¡ç†ç½‘ç»œæ•°æ®åŒ…çš„å¤„ç†å’Œè½¬å‘ï¼Œå¯ä»¥å°†iptablesç†è§£ä¸ºæ˜¯ä¸€ç³»åˆ—çš„è§„åˆ™ï¼Œå®ç°ä»Serviceåˆ°Podçš„æµé‡è½¬å‘ã€‚</p><p>é™¤äº†è®°å½•Serviceå’ŒPodçš„IP/ç«¯å£å¯¹çš„å…³ç³»ï¼Œ<strong>kube-proxyè¿˜ä¼šç›‘æ§Serviceå’ŒEndpointsçš„å˜åŒ–</strong>ï¼Œä»è€Œä¿è¯Podé‡å»ºåä»ç„¶èƒ½é€šè¿‡Serviceè®¿é—®åˆ°Podã€‚</p><p>ä¸‹å›¾æ˜¯ä¸€ä¸ªå®é™…è®¿é—®Serviceçš„å›¾ç¤ºï¼ŒPod Xè®¿é—®Serviceï¼ˆ10.247.124.252:8080ï¼‰ï¼Œåœ¨å‘é€æ•°æ®åŒ…æ—¶ï¼Œåœ¨èŠ‚ç‚¹ä¸Šæ ¹æ®iptablesè§„åˆ™ï¼Œç›®çš„IP:Portè¢«éšæœºæ›¿æ¢ä¸ºåç«¯Podç»„ä¸­æŸä¸€ä¸ªPodçš„IP:Portï¼Œä»è€Œé€šè¿‡Serviceè®¿é—®åˆ°å®é™…çš„Podã€‚</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-5.png width=1295 height=476 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-5_hu_921bbc58eeb3be0c.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-5_hu_8abd6d54bff4ac3c.png 1024w" loading=lazy alt=Serviceçš„å®ç°åŸç† class=gallery-image data-flex-grow=272 data-flex-basis=652px></p><h2 id=serviceçš„ç±»å‹>Serviceçš„ç±»å‹</h2><p>Serviceçš„ç±»å‹é™¤äº†ClusterIPè¿˜æœ‰NodePortã€LoadBalancerå’ŒHeadlessï¼Œè¿™å‡ ç§ç±»å‹çš„Serviceæœ‰ç€ä¸åŒçš„ç”¨é€”ã€‚</p><ul><li>ClusterIPï¼šç”¨äºåœ¨é›†ç¾¤å†…éƒ¨äº’ç›¸è®¿é—®çš„åœºæ™¯ï¼Œé€šè¿‡ClusterIPè®¿é—®Serviceã€‚</li><li>NodePortï¼šç”¨äºä»é›†ç¾¤å¤–éƒ¨è®¿é—®çš„åœºæ™¯ï¼Œé€šè¿‡èŠ‚ç‚¹ä¸Šçš„ç«¯å£è®¿é—®Serviceã€‚</li><li>LoadBalancerï¼šç”¨äºä»é›†ç¾¤å¤–éƒ¨è®¿é—®çš„åœºæ™¯ï¼Œå…¶å®æ˜¯NodePortçš„æ‰©å±•ï¼Œé€šè¿‡ä¸€ä¸ªç‰¹å®šçš„LoadBalancerè®¿é—®Serviceï¼Œè¿™ä¸ªLoadBalancerå°†è¯·æ±‚è½¬å‘åˆ°èŠ‚ç‚¹çš„NodePortï¼Œè€Œå¤–éƒ¨åªéœ€è¦è®¿é—®LoadBalancerã€‚</li><li>ç‰¹æ®Šçš„Serviceç±»å‹ â€“ Headless Serviceï¼šç”¨äºPodé—´çš„äº’ç›¸å‘ç°ã€‚</li></ul><h3 id=nodeport>NodePort</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nodeport-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30100</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>é¦–å…ˆä½¿ç”¨ä¸Šé¢çš„YAMLæ–‡ä»¶åˆ›å»ºä¸€ä¸ªNodePortç±»å‹çš„Serviceï¼Œå…¶ä¸­ï¼š</p><ul><li>Typeï¼šæŒ‡å®šè¯¥Serviceç±»å‹ä¸ºNodePortã€‚</li><li>spec.nodePortï¼šå¯æŒ‡å®šèŠ‚ç‚¹å¼€æ”¾çš„ç«¯å£ï¼Œæœ¬ä¾‹ä¸­æŒ‡å®šäº†è¯¥ç«¯å£ä¸ºâ€œ30120â€ï¼Œå¦‚æœä¸è¿›è¡ŒæŒ‡å®šï¼Œkubernetes masterå°†ä»ç»™å®šçš„é…ç½®èŒƒå›´å†…ï¼ˆé»˜è®¤ï¼š30000~32767ï¼‰åˆ†é…ç«¯å£ã€‚</li></ul><p>Serviceåˆ›å»ºå®Œæˆåï¼Œå¯ä»¥é€šè¿‡â€œèŠ‚ç‚¹çš„IP:Portâ€çš„å½¢å¼å°†æµé‡è½¬å‘åˆ°ç›¸åº”çš„Serviceï¼Œæœ€åè½¬å‘åˆ°åç«¯Podï¼Œ<strong>NodePortç±»å‹çš„Serviceä¹Ÿä¼šè¢«åˆ†é…ä¸€ä¸ªClusterIP</strong>ã€‚</p><p>NodePortç±»å‹çš„Serviceå¯ä»¥è®©Kubemetesé›†ç¾¤æ¯ä¸ªèŠ‚ç‚¹ä¸Šç›‘å¬ä¸€ä¸ªç›¸åŒçš„ç«¯å£ï¼Œå¤–éƒ¨è®¿é—®è¯·æ±‚é¦–å…ˆè®¿é—®èŠ‚ç‚¹IP:NodePortï¼Œå¯¹åº”èŠ‚ç‚¹å°†è¿™äº›è¯·æ±‚è½¬å‘ç»™Serviceå¯¹åº”çš„Endpointsï¼ˆå³PodIP:targetPortï¼‰ã€‚</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-6.png width=952 height=475 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-6_hu_442fc036f4eddbd8.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-6_hu_14123dff02938ce8.png 1024w" loading=lazy alt=NodePortå·¥ä½œåŸç† class=gallery-image data-flex-grow=200 data-flex-basis=481px></p><h3 id=loadbalancer>LoadBalancer</h3><p>LoadBalanceræœ¬èº«å¹¶ä¸æ˜¯Kubernetesçš„ç»„ä»¶ï¼Œè¿™éƒ¨åˆ†é€šå¸¸æ˜¯ç”±äº‘æœåŠ¡å‚å•†æä¾›ï¼Œä¸åŒå‚å•†çš„Kubernetesé›†ç¾¤ä¸LoadBalancerçš„å¯¹æ¥å®ç°å„ä¸ç›¸åŒï¼Œè¿™é‡Œä»¥åä¸ºäº‘å¯¹æ¥å¼¹æ€§è´Ÿè½½å‡è¡¡ELBæœåŠ¡ä¸ºä¾‹ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kubernetes.io/elb.id</span><span class=p>:</span><span class=w> </span><span class=l>3c7caa5a-a641-4bff-801a-feace27424b6</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>LoadBalancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>loadBalancerIP</span><span class=p>:</span><span class=w> </span><span class=m>10.78.42.242</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>nodePort</span><span class=p>:</span><span class=w> </span><span class=m>30120</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢ä¸ºä¸€ä¸ªLoadBalancerç±»å‹çš„Serviceå®ä¾‹çš„YAMLæ–‡ä»¶ï¼Œå…¶ä¸­ï¼š</p><ul><li>metadata.annotationsï¼šè¡¨ç¤ºCCEçš„LoadBalancerç±»å‹Serviceéœ€è¦é…ç½®çš„å‚æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªServiceç»‘å®šå“ªä¸ªELBå®ä¾‹ã€‚</li><li>loadBalancerIPï¼šæŒ‡å®šELBå®ä¾‹çš„IPåœ°å€ã€‚</li><li>typeï¼šæŒ‡å®šè¯¥Serviceç±»å‹ä¸ºLoadBalancerã€‚</li></ul><p>ä½¿ç”¨è¯¥YAMLæ–‡ä»¶åˆ›å»ºLoadBalancerç±»å‹çš„Serviceåï¼Œå¯ä»¥é€šè¿‡ELBçš„IP:Portè®¿é—®åˆ°åå°Podã€‚</p><p>LoadBalancerç±»å‹çš„Serviceå…¶å®æ˜¯NodePortç±»å‹Serviceçš„æ‰©å±•ï¼Œé€šè¿‡ä¸€ä¸ªç‰¹å®šçš„LoadBalancerè®¿é—®Serviceï¼Œè¯¥LoadBalancerå°†è¯·æ±‚è½¬å‘åˆ°èŠ‚ç‚¹çš„NodePortã€‚(åä¸ºäº‘äº‘åŸç”Ÿ2.0ç½‘ç»œæ”¯æŒELBç›´é€šPodIPï¼Œæ— éœ€ç»è¿‡NodePortè½¬å‘ã€‚)</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-7.png width=985 height=458 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-7_hu_708e1ad7d68b946c.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-7_hu_b9c7baa51099cbd2.png 1024w" loading=lazy alt=LoadBalancerå·¥ä½œåŸç† class=gallery-image data-flex-grow=215 data-flex-basis=516px></p><h3 id=headless-service>Headless Service</h3><p>é€šè¿‡ClusterIPå¯ä»¥å®ç°Podçš„å†…éƒ¨è®¿é—®ï¼Œé€šè¿‡NodePortå’ŒLoadBalancerå¯ä»¥å®ç°Podçš„å¤–éƒ¨è®¿é—®ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°ä¸€ä¸ªServiceå†…éƒ¨çš„Podä¹‹é—´çš„äº’ç›¸è®¿é—®å‘¢ï¼Ÿ</p><p>HeadlessServiceé€šè¿‡ä½¿ç”¨DNSï¼Œä¸ºæ¯ä¸ªPodæä¾›å›ºå®šçš„åŸŸåï¼Œè¿™æ ·Podä¹‹é—´å°±å¯ä»¥ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå³ä¾¿Podè¢«é‡æ–°åˆ›å»ºè€Œå¯¼è‡´Podçš„IPåœ°å€å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸ªåŸŸåä¹Ÿä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä»è€Œå®ç°Serviceå†…éƒ¨çš„Podä¹‹é—´çš„ç›¸äº’è®¿é—®ã€‚</p><p><img src=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-8.png width=1144 height=345 srcset="/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-8_hu_8ea002de527ef24a.png 480w, /p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-service/image-8_hu_12ff6ba1452b736.png 1024w" loading=lazy alt="Headless Service å·¥ä½œåŸç†" class=gallery-image data-flex-grow=331 data-flex-basis=795px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=l>None</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>ä½¿ç”¨ä¸Šé¢çš„YAMLæ–‡ä»¶åˆ›å»ºä¸€ä¸ªHeadlessç±»å‹çš„Serviceï¼Œå…¶ä¸­ï¼š</p><ul><li>spec.ports.nameï¼šæŒ‡å®šPodé—´é€šä¿¡ç«¯å£åç§°ï¼Œè¿™é‡Œè®¾ç½®ä¸ºâ€œnginxâ€ï¼›</li><li>spec.ports.portï¼šæŒ‡å®šPodé—´é€šä¿¡ç«¯å£å·ï¼Œè¿™é‡Œè®¾ç½®ä¸ºâ€œ80â€ï¼›</li><li>spec.selector.appï¼šæŒ‡å®šé€‰æ‹©æ ‡ç­¾ä¸ºâ€œapp: nginxâ€çš„Podï¼›</li><li>spec.clusterIPï¼šå¿…é¡»è®¾ç½®ä¸ºNoneï¼Œè¡¨ç¤ºHeadless Serviceã€‚</li></ul><h4 id=åˆ›å»ºheadless-service>åˆ›å»ºHeadless Service</h4><p>å°†ä¸Šè¿°çš„å†…å®¹ä¿å­˜åˆ°headless.yamlä¸­å¹¶æ‰§è¡Œåˆ›å»ºå‘½ä»¤<code>kubectl create -f headless.yaml</code></p><p>åˆ›å»ºå®ŒæˆåæŸ¥è¯¢Service <code>kubectl get svc</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>NAME  TYPE      CLUSTER-IP EXTERNAL-IP  PORT(S) AGE
</span></span><span class=line><span class=cl>nginx ClusterIP None&lt;none&gt;              80/TCP  5s
</span></span></code></pre></td></tr></table></div></div><p>Headless Serviceåˆ›å»ºåï¼Œæ¯ä¸ªPodçš„IPéƒ½ä¼šæœ‰ä¸‹é¢æ ¼å¼çš„åŸŸåï¼š<code>&lt;pod-name>.&lt;svc-name>.&lt;namespace>svc.cluster.local</code></p><blockquote><p>åŒæ ·çš„ï¼Œåœ¨åŒä¸€ä¸ªæœç´¢åŸŸä¸‹çš„<code>.&lt;namespace>.svc.cluster.local</code> å¯ä»¥çœç•¥</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/k8s/>K8s</a>
<a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/%E8%BF%90%E7%BB%B4/>è¿ç»´</a>
<a href=/tags/service/>Service</a>
<a href=/tags/%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE/>æœåŠ¡è®¿é—®</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E8%AE%BF%E9%97%AE-ingress/><div class=article-details><h2 class=article-title>Kubernetesçš„æœåŠ¡è®¿é—®-Ingress</h2></div></a></article><article><a href=/p/kubernetes%E7%9A%84%E5%AD%98%E5%82%A8/><div class=article-details><h2 class=article-title>Kubernetesçš„å­˜å‚¨</h2></div></a></article><article><a href=/p/kubernetes%E7%9A%84%E9%85%8D%E7%BD%AE%E6%9E%B6%E6%9E%84/><div class=article-details><h2 class=article-title>Kubernetesçš„é…ç½®æ¶æ„</h2></div></a></article><article><a href=/p/kube-apiserver%E7%9A%84list-watch%E6%9C%BA%E5%88%B6/><div class=article-details><h2 class=article-title>Kube-ApiServerçš„List-Watchæœºåˆ¶</h2></div></a></article><article><a href=/p/kubernetes%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%8D%95%E5%85%83-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD/><div class=article-details><h2 class=article-title>Kubernetesçš„æœåŠ¡å•å…ƒ - å·¥ä½œè´Ÿè½½</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=lee-cq/hugo-blog data-repo-id=R_kgDOHhaNdw data-category=Announcements data-category-id=DIC_kwDOHhaNd84CQtzr data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light data-lang=en data-loading crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"light":"dark")}})()</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 LeeCQå°ç©ºé—´</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>